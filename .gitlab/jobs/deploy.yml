push to github:
  stage: deploy
  image: bitnami/git
  when: manual
  only:
    - main
  before_script:
    - git fetch --unshallow || true
    - git config --global user.email "robot@whitebit.com"
    - git config --global user.name "whitebit-robot"
    - rm -rf .gitlab* Dockerfile docker-compose.yaml tests
    - git add .
    - git commit --amend --no-edit
    - git remote set-url origin $GITHUB_REPO
    - git filter-branch -f --env-filter "
        GIT_AUTHOR_NAME='whitebit-robot'
        GIT_AUTHOR_EMAIL='robot@whitebit.com'
        GIT_COMMITTER_NAME='whitebit-robot'
        GIT_COMMITTER_EMAIL='robot@whitebit.com'
      " HEAD
  script:
    - git push -f origin 'HEAD:main'